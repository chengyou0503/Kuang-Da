import"./style-b02JLB5g.js";const m={gasApi:{run(t,e={}){const o="https://script.google.com/macros/s/AKfycbx31ivAfspeozu41_daj3he55e9M4v36G_FrhE8vlfuxSzLeIGKi83l0bLcI4WFqPfgVA/exec";return console.log(`%c[API Request] -> ${t}`,"color: #0052cc; font-weight: bold;",e),new Promise((l,a)=>{const d=`jsonp_callback_admin_${Date.now()}_${Math.floor(Math.random()*1e5)}`,n=document.createElement("script");let c=`${o}?action=${t}&callback=${d}`;Object.keys(e).forEach(i=>{let s=e[i];typeof s=="object"&&(s=JSON.stringify(s)),c+=`&${encodeURIComponent(i)}=${encodeURIComponent(s)}`}),n.src=c;const h=setTimeout(()=>{a(new Error(`Request timed out for action: ${t}`)),r()},3e4);window[d]=i=>{i.success?console.log(`%c[API Response] <- ${t}`,"color: #00875a; font-weight: bold;",i):console.error(`%c[API Error] <- ${t}`,"color: #de350b; font-weight: bold;",i),l(i),r()};const r=()=>{clearTimeout(h),delete window[d],n.parentNode&&n.parentNode.removeChild(n)};n.onerror=()=>{a(new Error(`Script error for action: ${t}`)),r()},document.head.appendChild(n)})}},dom:{},config:{},init(){this.dom={loader:document.getElementById("loader"),notification:document.getElementById("notification"),formTypeSelect:document.getElementById("form-type"),exportBtn:document.getElementById("export-btn"),log:document.getElementById("export-log")},this.showLoader("正在載入設定..."),this.gasApi.run("getInitialPayload").then(t=>{t.success?(this.config=t.data.config,this.populateFormTypes(),this.setupEventListeners(),this.hideLoader()):this.handleError(t.message)}).catch(this.handleError.bind(this))},populateFormTypes(){[...this.config.IN_FACTORY_FORMS,...this.config.OUT_FACTORY_FORMS].forEach(e=>{const o=document.createElement("option");o.value=e,o.textContent=`${this.config.FORM_NAMES[e]} (${e})`,this.dom.formTypeSelect.appendChild(o)})},setupEventListeners(){this.dom.exportBtn.addEventListener("click",this.startExport.bind(this))},startExport(){const t={formId:document.getElementById("form-type").value,vehicleModel:document.getElementById("vehicle-model").value.trim().toUpperCase(),startDate:document.getElementById("start-date").value,endDate:document.getElementById("end-date").value};if(!t.startDate||!t.endDate)return this.showNotification("請選擇開始和結束日期","error");this.showLoader("正在準備導出..."),this.dom.exportBtn.disabled=!0,this.dom.log.textContent=`導出任務已啟動，請稍候...
`,this.gasApi.run("bulkExportPdfs",{options:t}).then(e=>{this.hideLoader(),this.dom.exportBtn.disabled=!1,e.success?(this.showNotification(e.message,"success"),this.dom.log.textContent+=`✔ ${e.message}
`,e.folderUrl&&(this.dom.log.textContent+=`✔ 報告已儲存至雲端資料夾: ${e.folderUrl}
`)):this.handleError(e.message)}).catch(this.handleError.bind(this))},showLoader(t="處理中..."){this.dom.loader.classList.remove("hidden"),this.dom.loader.querySelector("p").textContent=t},hideLoader(){this.dom.loader.classList.add("hidden")},showNotification(t,e="success"){const o=this.dom.notification;o.textContent=t,o.className=`${e} show`,setTimeout(()=>{o.className="hidden"},4e3)},handleError(t){this.hideLoader(),this.dom.exportBtn.disabled=!1;const e=typeof t=="object"?t.message||JSON.stringify(t):String(t);this.showNotification(`操作失敗：${e}`,"error"),this.dom.log.textContent+=`✖ 操作失敗: ${e}
`,console.error("[Admin App Error]",t)}};document.addEventListener("DOMContentLoaded",()=>m.init());
